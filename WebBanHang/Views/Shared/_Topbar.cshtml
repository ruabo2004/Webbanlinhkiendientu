<div class="top-bar" style="display: flex; align-items: center; justify-content: space-between; padding: 12px 20px; background-color: #D70018; color: white;">
    <!-- Logo -->
    <div class="logo-holder" style="flex-shrink: 0; margin-right: 20px;">
        <a href="@Url.Action("Index", "Home")" style="display: flex; align-items: center; text-decoration: none;">
            <img src="@Url.Content("~/Content/images/logo.png")" alt="Logo" style="max-height: 50px; height: auto; width: auto;" />
        </a>
    </div>

    <!-- Thanh tìm kiếm -->
    <div class="top-search-holder" style="flex-grow: 1; max-width: 500px; margin-right: 20px;">
        @Html.Action("Search", "Widget")
    </div>

    <!-- Thông tin liên hệ -->
    <div class="info-links" style="display: flex; align-items: center; gap: 15px; margin-right: 15px;">
        <div style="display: flex; align-items: center; gap: 5px; font-size: 13px; white-space: nowrap;">
            <i class="fa fa-phone"></i> 
            <span>Gọi mua hàng <strong>1800.2097</strong></span>
        </div>
        <div style="display: flex; align-items: center; gap: 5px; font-size: 13px; white-space: nowrap;">
            <i class="fa fa-map-marker"></i> 
            <span>Giảm 10% khi mua tại quầy</span>
        </div>
    </div>    
    
    <!-- Giáỏ hàng và tài khoản -->
    <div class="user-actions" style="display: flex; align-items: center; gap: 10px;">
        <!-- Giỏ hàng -->
        <div id="cart_shop">
            @{
                var cart = ShoppingCart.Instance;
                var cartCount = cart.GetCount();
            }
            <a href="@Url.Action("Index", "Cart")" id="cart_button" style="background-color: transparent; color: white; padding: 8px 16px; display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 500; cursor: pointer; border: none; text-decoration: none;">
                <i class="fa fa-shopping-cart" style="font-size: 18px;"></i>
                <span>Giỏ hàng</span>
                <span id="cart-count" style="background-color: #ff4d4d; border: 1px solid rgba(255,255,255,0.3); color: white; padding: 2px 8px; border-radius: 12px; font-size: 12px; font-weight: 500; min-width: 20px; text-align: center; display: inline-block;">@cartCount</span>
            </a>
        </div>
        
        <!-- Separator -->
        <div style="width: 1px; height: 20px; background: rgba(255,255,255,0.3);"></div>
        
        <!-- Đăng nhập/Đăng ký -->
        <div class="cnt-account" style="display: flex; align-items: center; gap: 10px;">
            @if (!User.Identity.IsAuthenticated)
            {
                <a href="@Url.Action("Login", "Customer")" style="color: white; text-decoration: none; font-size: 14px; display: flex; align-items: center; gap: 5px;">
                    <i class="fa fa-arrow-right"></i> Đăng nhập
                </a>
                <div style="width: 1px; height: 20px; background: rgba(255,255,255,0.3);"></div>
                <a href="@Url.Action("Register", "Customer")" style="color: white; text-decoration: none; font-size: 14px; display: flex; align-items: center; gap: 5px;">
                    <i class="fa fa-arrow-right"></i> Đăng ký
                </a>
            }
            else
            {
                <div class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" style="color: white; text-decoration: none; display: flex; align-items: center; gap: 5px; font-size: 14px;">
                        @if (UserManager.CurrentCustomer.MemberRank != null)
                        {
                            var rank = UserManager.CurrentCustomer.MemberRank;
                            var badgeGradient = "";
                            switch (rank.RankID)
                            {
                                case 1:
                                    badgeGradient = "linear-gradient(135deg, #667eea 0%, #764ba2 100%)";
                                    break;
                                case 2:
                                    badgeGradient = "linear-gradient(135deg, #CD7F32 0%, #8B4513 100%)";
                                    break;
                                case 3:
                                    badgeGradient = "linear-gradient(135deg, #C0C0C0 0%, #808080 100%)";
                                    break;
                                case 4:
                                    badgeGradient = "linear-gradient(135deg, #FFD700 0%, #FFA500 100%)";
                                    break;
                                case 5:
                                    badgeGradient = "linear-gradient(135deg, #00D4FF 0%, #0099CC 100%)";
                                    break;
                                default:
                                    badgeGradient = "linear-gradient(135deg, #667eea 0%, #764ba2 100%)";
                                    break;
                            }
                            <span class="member-rank-badge" style="background: @badgeGradient; color: white; padding: 3px 10px; border-radius: 12px; font-size: 11px; font-weight: bold; margin-right: 5px; text-shadow: 0 1px 2px rgba(0,0,0,0.3);">
                                <i class="@rank.GetIconClass()" style="font-size: 10px;"></i> @rank.RankName
                            </span>
                        }
                        <span>Xin chào, @UserManager.CurrentCustomer.FullName</span>
                        <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu">
                        @if (UserManager.CurrentCustomer.MemberRank != null)
                        {
                            var rank = UserManager.CurrentCustomer.MemberRank;
                            
                            // Luôn dùng màu mặc định theo RankID, không dùng ColorCode từ database
                            string gradientColor = "";
                            switch (rank.RankID)
                            {
                                case 1:
                                    gradientColor = "linear-gradient(135deg, #667eea 0%, #764ba2 100%)";
                                    break;
                                case 2:
                                    gradientColor = "linear-gradient(135deg, #CD7F32 0%, #8B4513 100%)";
                                    break;
                                case 3:
                                    gradientColor = "linear-gradient(135deg, #C0C0C0 0%, #808080 100%)";
                                    break;
                                case 4:
                                    gradientColor = "linear-gradient(135deg, #FFD700 0%, #FFA500 100%)";
                                    break;
                                case 5:
                                    gradientColor = "linear-gradient(135deg, #00D4FF 0%, #0099CC 100%)";
                                    break;
                                default:
                                    gradientColor = "linear-gradient(135deg, #667eea 0%, #764ba2 100%)";
                                    break;
                            }
                            
                            // Lấy màu rank (fallback nếu không có ColorCode)
                            var rankColor = "#667eea";
                            if (!string.IsNullOrEmpty(rank.ColorCode))
                            {
                                rankColor = rank.ColorCode;
                            }
                            else
                            {
                                // Fallback màu theo RankID
                                switch (rank.RankID)
                                {
                                    case 1: rankColor = "#667eea"; break;
                                    case 2: rankColor = "#CD7F32"; break;
                                    case 3: rankColor = "#C0C0C0"; break;
                                    case 4: rankColor = "#FFD700"; break;
                                    case 5: rankColor = "#00D4FF"; break;
                                }
                            }
                            var iconClass = rank.GetIconClass();
                            
                            <li class="rank-info-menu rank-info-menu-@rank.RankID" style="padding: 10px 15px !important; background-image: @gradientColor !important; background: @gradientColor !important; color: white !important; border-bottom: 1px solid rgba(255,255,255,0.2) !important; text-shadow: 0 1px 2px rgba(0,0,0,0.3) !important; box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <div style="width: 40px; height: 40px; border-radius: 50%; background: @rankColor !important; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                                        <i class="@iconClass" style="color: white !important; font-size: 18px;"></i>
                                    </div>
                                    <div style="flex: 1;">
                                        <div style="font-weight: bold; font-size: 15px; margin-bottom: 2px;">
                                            @rank.RankName
                                        </div>
                                        <div style="font-size: 11px; opacity: 0.9;">
                                            <i class="fa fa-shield"></i> Hạng thành viên
                                        </div>
                                    </div>
                                </div>
                                <div style="font-size: 12px; opacity: 0.95; margin-bottom: 8px; padding-top: 8px; border-top: 1px solid rgba(255,255,255,0.2);">
                                    <i class="fa fa-money"></i> <strong>Đã chi:</strong> @Html.FormatCurrency(UserManager.CurrentCustomer.TotalSpent) đ
                                </div>
                                @if (rank.DiscountPercent > 0)
                                {
                                    <div style="font-size: 12px; opacity: 0.95; background: rgba(255,255,255,0.25); padding: 6px 10px; border-radius: 8px; display: inline-block; box-shadow: 0 1px 3px rgba(0,0,0,0.2);">
                                        <i class="fa fa-gift"></i> <strong>Ưu đãi:</strong> Giảm @rank.DiscountPercent%
                                    </div>
                                }
                            </li>
                        }
                        <li>
                            <a href="@Url.Action("Profile", "Customer")"><i class="icon fa fa-user"></i> Quản lý tài khoản</a>
                        </li>
                        <li>
                            <a href="@Url.Action("Index", "Order")"><i class="icon fa fa-shopping-bag"></i> Đơn hàng của tôi</a>
                        </li>
                        <li class="divider"></li>
                        <li>
                            <a href="@Url.Action("Logout", "Customer")"><i class="icon fa fa-sign-out"></i> Đăng xuất</a>
                        </li>
                    </ul>
                </div>
            }
        </div>
    </div>
</div>
<style>
    .top-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 12px 20px;
        background-color: #D70018;
    }

    .top-search-holder {
        flex-grow: 1;
        max-width: 500px;
    }
    
    .top-search-holder .search-area {
        width: 100%;
    }

    #cart_button:hover {
        opacity: 0.8;
    }
    
    .member-rank-badge {
        display: inline-flex;
        align-items: center;
        gap: 3px;
        white-space: nowrap;
        box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .rank-info-menu {
        pointer-events: none;
    }
    
    .dropdown-menu {
        min-width: 250px;
    }
    
    .dropdown-menu .rank-info-menu div {
        margin: 3px 0;
    }
    
    /* Đảm bảo rank-info-menu hiển thị gradient màu - override tất cả CSS khác */
    .top-bar .user-actions .dropdown-menu li.rank-info-menu,
    .dropdown-menu li.rank-info-menu {
        /* Cho phép inline style có độ ưu tiên cao nhất */
    }
    
    /* Override tất cả background từ CSS khác */
    .top-bar .user-actions .dropdown-menu li.rank-info-menu[style*="background"],
    .dropdown-menu li.rank-info-menu[style*="background"] {
        background-color: transparent !important;
    }
    
    /* CSS cho từng rank cụ thể - đảm bảo màu hiển thị với độ ưu tiên cao nhất */
    .top-bar .user-actions .dropdown-menu li.rank-info-menu-1,
    .dropdown-menu li.rank-info-menu-1 {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        background-image: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        background-color: transparent !important;
        background-size: 100% 100% !important;
        color: white !important;
    }
    
    .top-bar .user-actions .dropdown-menu li.rank-info-menu-2,
    .dropdown-menu li.rank-info-menu-2 {
        background: linear-gradient(135deg, #CD7F32 0%, #8B4513 100%) !important;
        background-image: linear-gradient(135deg, #CD7F32 0%, #8B4513 100%) !important;
        background-color: transparent !important;
        background-size: 100% 100% !important;
        color: white !important;
    }
    
    .top-bar .user-actions .dropdown-menu li.rank-info-menu-3,
    .dropdown-menu li.rank-info-menu-3 {
        background: linear-gradient(135deg, #C0C0C0 0%, #808080 100%) !important;
        background-image: linear-gradient(135deg, #C0C0C0 0%, #808080 100%) !important;
        background-color: transparent !important;
        background-size: 100% 100% !important;
        color: white !important;
    }
    
    .top-bar .user-actions .dropdown-menu li.rank-info-menu-4,
    .dropdown-menu li.rank-info-menu-4 {
        background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%) !important;
        background-image: linear-gradient(135deg, #FFD700 0%, #FFA500 100%) !important;
        background-color: transparent !important;
        background-size: 100% 100% !important;
        color: white !important;
    }
    
    .top-bar .user-actions .dropdown-menu li.rank-info-menu-5,
    .dropdown-menu li.rank-info-menu-5 {
        background: linear-gradient(135deg, #00D4FF 0%, #0099CC 100%) !important;
        background-image: linear-gradient(135deg, #00D4FF 0%, #0099CC 100%) !important;
        background-color: transparent !important;
        background-size: 100% 100% !important;
        color: white !important;
    }
    
    /* Đảm bảo không có CSS nào override background của rank-info-menu */
    .top-bar .user-actions .dropdown-menu li.rank-info-menu,
    .dropdown-menu li.rank-info-menu {
        background-repeat: no-repeat !important;
        background-position: center !important;
        background-attachment: local !important;
    }
    
    .cnt-account a:hover {
        opacity: 0.8;
    }
    
    /* Force override - đảm bảo màu rank hiển thị với độ ưu tiên cao nhất */
    .top-bar .user-actions ul.dropdown-menu li.rank-info-menu-1,
    .top-bar .user-actions ul.dropdown-menu li.rank-info-menu-2,
    .top-bar .user-actions ul.dropdown-menu li.rank-info-menu-3,
    .top-bar .user-actions ul.dropdown-menu li.rank-info-menu-4,
    .top-bar .user-actions ul.dropdown-menu li.rank-info-menu-5 {
        background-repeat: no-repeat !important;
        background-position: center center !important;
        background-attachment: scroll !important;
        background-size: cover !important;
    }
</style>


